<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <title>Radar zrážok – Open-Meteo</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    html, body, #map {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
    }
    .leaflet-control-zoom,
    .leaflet-control-attribution {
      display: none;
    }
    #controls {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(7,44,78,0.9);
      padding: 10px 16px;
      border-radius: 25px;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 10000;
    }
    #controls button {
      background: #0D3F73;
      border: none;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #controls img {
      width: 22px;
      height: 22px;
      filter: invert(1);
    }
    #timeBox {
      position: fixed;
      bottom: 25px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(7,44,78,0.9);
      color: white;
      padding: 8px 20px;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      z-index: 10000;
      font-family: Arial, sans-serif;
    }
  </style>
</head>
<body>
<div id="map"></div>

<div id="controls">
  <button id="back">⏪</button>
  <button id="play">▶️</button>
  <button id="next">⏩</button>
</div>
<div id="timeBox">Načítavam čas...</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
<script>
  const map = L.map('map', {zoomControl: false, attributionControl: false}).setView([48.7, 19.7], 7);

  L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    subdomains: 'abcd',
    maxZoom: 12
  }).addTo(map);

  let frames = [];
  let currentIndex = 0;
  let playInterval = null;
  let heatLayer = null;

  const timeBox = document.getElementById("timeBox");

  async function loadData() {
    const response = await fetch(
      "https://api.open-meteo.com/v1/forecast?latitude=48.7&longitude=19.7&hourly=precipitation&forecast_days=1"
    );
    const data = await response.json();
    frames = [];

    for (let i = 0; i < data.hourly.time.length; i++) {
      let time = new Date(data.hourly.time[i]);
      let rain = data.hourly.precipitation[i];

      // Generovanie bodov okolo Slovenska (jednoduché, nie reálne)
      let points = [];
      for (let lat = 47.7; lat <= 49.7; lat += 0.3) {
        for (let lon = 16.5; lon <= 22.5; lon += 0.3) {
          let intensity = Math.max(0, rain - Math.random() * 0.5);
          if (intensity > 0) points.push([lat, lon, intensity / 5]);
        }
      }
      frames.push({time, points});
    }
    showFrame(frames.length - 1);
  }

  function showFrame(index) {
    if (!frames[index]) return;
    if (heatLayer) map.removeLayer(heatLayer);
    heatLayer = L.heatLayer(frames[index].points, {
      radius: 25,
      blur: 20,
      maxZoom: 12,
      gradient: {
        0.2: "green",
        0.5: "yellow",
        0.8: "red"
      }
    }).addTo(map);
    timeBox.textContent = frames[index].time.toLocaleString();
  }

  document.getElementById("back").onclick = () => {
    currentIndex = (currentIndex - 1 + frames.length) % frames.length;
    showFrame(currentIndex);
  };

  document.getElementById("next").onclick = () => {
    currentIndex = (currentIndex + 1) % frames.length;
    showFrame(currentIndex);
  };

  document.getElementById("play").onclick = () => {
    if (playInterval) {
      clearInterval(playInterval);
      playInterval = null;
      document.getElementById("play").textContent = "▶️";
    } else {
      playInterval = setInterval(() => {
        currentIndex = (currentIndex + 1) % frames.length;
        showFrame(currentIndex);
      }, 700);
      document.getElementById("play").textContent = "⏸️";
    }
  };

  loadData();
</script>
</body>
</html>
